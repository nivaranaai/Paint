{% extends 'colorsense/base_nivarana.html' %}
{% load static %}

{% block title %}Groq AI Demo - Nivarana.ai{% endblock %}

{% block content %}
<div class="page-title dark-background" style="background-image: url({% static 'logis/img/page-title-bg.jpg' %}); padding: 120px 0 60px 0;">
  <div class="container position-relative">
    <h1>Groq AI Demo</h1>
    <p>Experience lightning-fast AI responses with Groq's cutting-edge technology</p>
  </div>
</div>

<section class="service-details section">
  <div class="container">
    <!-- Models Section -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>Available Models</h5>
          </div>
          <div class="card-body">
            <button class="btn btn-outline-primary" onclick="loadModels()">
              <i class="bi bi-arrow-clockwise me-1"></i>Load Models
            </button>
            <div id="models-response" class="mt-3" style="display: none;"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Chat Section -->
      <div class="col-lg-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="bi bi-chat-dots me-2"></i>Chat Test</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="chat-message" class="form-label">Message</label>
              <textarea id="chat-message" class="form-control" placeholder="Enter your message..." rows="3"></textarea>
            </div>
            <button class="btn btn-success" onclick="sendChat()">
              <i class="bi bi-send me-1"></i>Send Chat
            </button>
            <div id="chat-response" class="mt-3 p-3 bg-light rounded" style="display: none; min-height: 100px;"></div>
          </div>
        </div>
      </div>

      <!-- Vision Section -->
      <div class="col-lg-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="bi bi-eye me-2"></i>Vision Analysis</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="vision-text" class="form-label">Question about image</label>
              <input type="text" id="vision-text" class="form-control" placeholder="What do you want to know?">
            </div>
            <div class="mb-3">
              <label for="vision-image" class="form-label">Upload Image</label>
              <input type="file" id="vision-image" class="form-control" accept="image/*">
            </div>
            <button class="btn btn-info" onclick="sendVision()">
              <i class="bi bi-search me-1"></i>Analyze Image
            </button>
            <div id="vision-response" class="mt-3 p-3 bg-light rounded" style="display: none; min-height: 100px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
async function loadModels() {
    const element = document.getElementById('models-response');
    element.style.display = 'block';
    element.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Loading...';
    
    try {
        const response = await fetch('/api/groq/models/');
        const data = await response.json();
        
        if (data.success) {
            const modelsHtml = data.models.map(model => 
                `<span class="badge bg-secondary me-2 mb-2">${model}</span>`
            ).join('');
            element.innerHTML = modelsHtml;
        } else {
            element.innerHTML = `<div class="alert alert-danger">Error: ${data.error}</div>`;
        }
    } catch (error) {
        element.innerHTML = `<div class="alert alert-danger">Network error: ${error.message}</div>`;
    }
}

async function sendChat() {
    const message = document.getElementById('chat-message').value.trim();
    const responseDiv = document.getElementById('chat-response');
    
    if (!message) {
        responseDiv.style.display = 'block';
        responseDiv.innerHTML = '<div class="alert alert-warning">Please enter a message</div>';
        return;
    }
    
    responseDiv.style.display = 'block';
    responseDiv.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Processing...';
    
    try {
        const response = await fetch('/api/groq/chat/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
        });
        
        const data = await response.json();
        
        if (data.success) {
            responseDiv.innerHTML = `<div class="alert alert-success"><strong>Response:</strong><br>${data.response}</div>`;
        } else {
            responseDiv.innerHTML = `<div class="alert alert-danger">Error: ${data.error}</div>`;
        }
    } catch (error) {
        responseDiv.innerHTML = `<div class="alert alert-danger">Network error: ${error.message}</div>`;
    }
}

async function sendVision() {
    const text = document.getElementById('vision-text').value.trim();
    const imageFile = document.getElementById('vision-image').files[0];
    const responseDiv = document.getElementById('vision-response');
    
    if (!imageFile) {
        responseDiv.style.display = 'block';
        responseDiv.innerHTML = '<div class="alert alert-warning">Please select an image</div>';
        return;
    }
    
    responseDiv.style.display = 'block';
    responseDiv.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Analyzing...';
    
    try {
        const formData = new FormData();
        formData.append('text', text || 'Describe this image');
        formData.append('image', imageFile);
        
        const response = await fetch('/api/groq/vision/', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            responseDiv.innerHTML = `<div class="alert alert-success"><strong>Analysis:</strong><br>${data.response}</div>`;
        } else {
            responseDiv.innerHTML = `<div class="alert alert-danger">Error: ${data.error}</div>`;
        }
    } catch (error) {
        responseDiv.innerHTML = `<div class="alert alert-danger">Network error: ${error.message}</div>`;
    }
}

// Load models on page load
window.addEventListener('load', loadModels);
</script>
{% endblock %}